<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kompass Man - Das PHZH Strategie-Spiel</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        :root {
            --teal: #00897B;
            --teal-dark: #00695C;
            --teal-light: #4DB6AC;
            --orange: #FF9800;
            --orange-dark: #F57C00;
            --yellow: #FFD600;
            --red: #E53935;
            --green: #43A047;
            --blue: #1E88E5;
            --purple: #8E24AA;
            --pink: #E91E63;
            --bg-dark: #0a1628;
            --bg-card: rgba(255,255,255,0.07);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', sans-serif;
            background: var(--bg-dark);
            color: white;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
        }

        .retro { font-family: 'Press Start 2P', monospace; }

        /* ====== SCREEN CONTAINER ====== */
        .screen {
            display: none;
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            overflow-y: auto;
        }
        .screen.active { display: flex; }

        /* ====== FLOATING PARTICLES ====== */
        .particles {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 0;
        }
        .particle {
            position: absolute;
            border-radius: 50%;
            opacity: 0.15;
            animation: floatParticle 15s infinite ease-in-out;
        }
        @keyframes floatParticle {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            25% { transform: translateY(-30px) rotate(90deg); }
            50% { transform: translateY(-60px) rotate(180deg); }
            75% { transform: translateY(-30px) rotate(270deg); }
        }

        /* ====== TITLE SCREEN ====== */
        #titleScreen {
            background: linear-gradient(135deg, #0a1628, #1a2a4a, #0a1628);
        }
        .title-logo {
            font-size: clamp(24px, 5vw, 48px);
            color: var(--yellow);
            text-shadow: 0 0 20px rgba(255,214,0,0.5), 0 4px 0 var(--orange);
            animation: titlePulse 2s infinite;
            text-align: center;
            margin-bottom: 10px;
        }
        @keyframes titlePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.03); }
        }
        .title-subtitle {
            font-size: clamp(10px, 2vw, 16px);
            color: var(--teal-light);
            margin-bottom: 40px;
            text-align: center;
        }

        /* Kompass Man Character */
        .kompass-man {
            width: 120px; height: 120px;
            position: relative;
            margin: 20px 0 30px;
            animation: bounce 1s infinite;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }
        .km-body {
            width: 80px; height: 80px;
            background: var(--yellow);
            border-radius: 50%;
            position: absolute;
            top: 10px; left: 20px;
            box-shadow: 0 0 30px rgba(255,214,0,0.4);
            overflow: hidden;
        }
        .km-mouth {
            position: absolute;
            right: -5px; top: 25px;
            width: 0; height: 0;
            border-left: 25px solid var(--bg-dark);
            border-top: 18px solid transparent;
            border-bottom: 18px solid transparent;
            animation: chomp 0.4s infinite;
        }
        @keyframes chomp {
            0%, 100% { transform: scaleY(1); }
            50% { transform: scaleY(0.1); }
        }
        .km-eye {
            width: 10px; height: 10px;
            background: var(--bg-dark);
            border-radius: 50%;
            position: absolute;
            top: 15px; left: 42px;
        }
        .km-cape {
            width: 40px; height: 50px;
            background: var(--red);
            position: absolute;
            top: 30px; left: 5px;
            border-radius: 0 0 20px 20px;
            transform: rotate(-15deg);
            animation: capeFlow 1.5s infinite ease-in-out;
        }
        @keyframes capeFlow {
            0%, 100% { transform: rotate(-15deg) scaleX(1); }
            50% { transform: rotate(-20deg) scaleX(1.1); }
        }
        .km-compass {
            width: 24px; height: 24px;
            background: white;
            border-radius: 50%;
            position: absolute;
            top: 35px; left: 48px;
            border: 2px solid var(--teal);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .km-needle {
            width: 3px; height: 14px;
            background: linear-gradient(var(--red) 50%, var(--blue) 50%);
            animation: spin 2s infinite linear;
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        /* Buttons */
        .btn {
            padding: 15px 40px;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            z-index: 2;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .btn:hover { transform: translateY(-3px); box-shadow: 0 8px 25px rgba(0,0,0,0.3); }
        .btn:active { transform: translateY(0); }
        .btn-primary {
            background: linear-gradient(135deg, var(--teal), var(--teal-dark));
            color: white;
        }
        .btn-yellow {
            background: linear-gradient(135deg, var(--yellow), var(--orange));
            color: #333;
        }
        .btn-start {
            animation: pulseBtn 2s infinite;
            font-family: 'Press Start 2P', monospace;
            font-size: 14px;
            padding: 20px 50px;
        }
        @keyframes pulseBtn {
            0%, 100% { box-shadow: 0 0 0 0 rgba(255,214,0,0.4); }
            50% { box-shadow: 0 0 0 15px rgba(255,214,0,0); }
        }
        .btn-small {
            padding: 10px 25px;
            font-size: 14px;
        }

        /* ====== STORY SCREEN ====== */
        #storyScreen {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
        }
        .story-box {
            max-width: 700px;
            background: var(--bg-card);
            border: 2px solid var(--teal);
            border-radius: 20px;
            padding: 30px;
            margin: 15px 0;
            position: relative;
            backdrop-filter: blur(10px);
        }
        .story-box::before {
            content: '';
            position: absolute;
            top: -2px; left: -2px;
            right: -2px; bottom: -2px;
            border-radius: 22px;
            background: linear-gradient(45deg, var(--teal), var(--yellow), var(--teal));
            z-index: -1;
            opacity: 0.3;
        }
        .story-emoji { font-size: 50px; margin-bottom: 15px; display: block; text-align: center; }
        .story-text {
            font-size: clamp(14px, 2.5vw, 18px);
            line-height: 1.7;
            text-align: center;
        }
        .story-text strong { color: var(--yellow); }
        .story-counter {
            font-size: 12px;
            color: var(--teal-light);
            margin-top: 15px;
            text-align: center;
        }

        /* ====== ROLE SELECTION ====== */
        #roleScreen {
            background: linear-gradient(135deg, #1a1a2e, #0d1b2a);
        }
        .role-cards {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
            justify-content: center;
            margin: 30px 0;
        }
        .role-card {
            width: 280px;
            background: var(--bg-card);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 30px;
            cursor: pointer;
            transition: all 0.4s;
            text-align: center;
            backdrop-filter: blur(10px);
        }
        .role-card:hover {
            border-color: var(--yellow);
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }
        .role-card.selected {
            border-color: var(--yellow);
            background: rgba(255,214,0,0.1);
        }
        .role-icon { font-size: 60px; margin-bottom: 15px; }
        .role-title { font-size: 22px; font-weight: bold; color: var(--yellow); margin-bottom: 10px; }
        .role-desc { font-size: 14px; line-height: 1.6; color: #ccc; }
        .role-joke { font-size: 12px; color: var(--orange); margin-top: 12px; font-style: italic; }

        /* ====== GAME HUD ====== */
        .hud {
            position: fixed;
            top: 0; left: 0;
            width: 100%;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(10px);
            z-index: 100;
            border-bottom: 2px solid var(--teal);
        }
        .hud-left, .hud-right { display: flex; align-items: center; gap: 20px; }
        .hud-score { color: var(--yellow); font-size: 14px; }
        .hud-level { color: var(--teal-light); font-size: 12px; }
        .hud-timer {
            background: var(--red);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            min-width: 60px;
            text-align: center;
        }
        .hud-lives { font-size: 20px; }

        /* ====== LEVEL 1: CATCH GAME ====== */
        #level1Screen, #level2Screen, #level3Screen, #level4Screen, #level5Screen {
            background: linear-gradient(180deg, #0a1628, #1a2a4a);
            padding-top: 60px;
        }
        .game-area {
            position: relative;
            width: min(800px, 95vw);
            height: min(500px, 60vh);
            border: 2px solid var(--teal);
            border-radius: 15px;
            overflow: hidden;
            background: rgba(0,0,0,0.3);
            margin-top: 20px;
        }
        .catch-bucket {
            position: absolute;
            bottom: 10px;
            width: 120px;
            height: 45px;
            border-radius: 10px 10px 15px 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: bold;
            transition: left 0.1s;
            cursor: grab;
            text-align: center;
            border: 2px solid rgba(255,255,255,0.3);
            z-index: 10;
        }
        .bucket-initiative { background: linear-gradient(135deg, var(--teal), var(--teal-dark)); left: 5%; }
        .bucket-aktivitaet { background: linear-gradient(135deg, var(--blue), #1565C0); left: 38%; }
        .bucket-massnahme { background: linear-gradient(135deg, var(--orange), var(--orange-dark)); left: 71%; }
        .bucket-active {
            box-shadow: 0 0 20px rgba(255,214,0,0.6);
            border-color: var(--yellow);
        }

        .falling-item {
            position: absolute;
            padding: 8px 14px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: bold;
            text-align: center;
            transition: none;
            z-index: 5;
            min-width: 100px;
            white-space: nowrap;
        }
        .item-initiative { background: var(--teal); border: 2px solid var(--teal-light); }
        .item-aktivitaet { background: var(--blue); border: 2px solid #42A5F5; }
        .item-massnahme { background: var(--orange); border: 2px solid var(--yellow); color: #333; }
        .item-distraction { background: var(--pink); border: 2px solid #F48FB1; }

        /* ====== LEVEL 2: DRAG & DROP SORT ====== */
        .sort-container {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
            width: min(900px, 95vw);
            margin-top: 20px;
        }
        .sort-column {
            width: 250px;
            min-height: 300px;
            background: var(--bg-card);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 15px;
        }
        .sort-column-header {
            text-align: center;
            font-weight: bold;
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 10px;
            font-size: 14px;
        }
        .sort-column-init .sort-column-header { background: var(--teal); }
        .sort-column-akt .sort-column-header { background: var(--blue); }
        .sort-column-mass .sort-column-header { background: var(--orange); color: #333; }

        .sort-item {
            padding: 10px 15px;
            margin: 8px 0;
            border-radius: 8px;
            cursor: grab;
            font-size: 13px;
            transition: all 0.2s;
            border: 2px solid transparent;
        }
        .sort-item:hover { transform: scale(1.03); }
        .sort-item.dragging { opacity: 0.5; transform: scale(0.95); }
        .sort-item-init { background: rgba(0,137,123,0.3); border-color: var(--teal); }
        .sort-item-akt { background: rgba(30,136,229,0.3); border-color: var(--blue); }
        .sort-item-mass { background: rgba(255,152,0,0.3); border-color: var(--orange); }
        .sort-item-wrong { animation: shake 0.5s; border-color: var(--red) !important; }
        .sort-item-correct { border-color: var(--green) !important; background: rgba(67,160,71,0.2) !important; }
        .drop-highlight { border-color: var(--yellow) !important; background: rgba(255,214,0,0.05); }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20% { transform: translateX(-10px); }
            40% { transform: translateX(10px); }
            60% { transform: translateX(-10px); }
            80% { transform: translateX(10px); }
        }

        /* ====== LEVEL 3: PHASE ASSIGNMENT ====== */
        .phase-card {
            max-width: 600px;
            width: 95%;
            background: var(--bg-card);
            border: 2px solid var(--teal);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            backdrop-filter: blur(10px);
        }
        .phase-scenario {
            font-size: 18px;
            margin: 20px 0;
            line-height: 1.6;
        }
        .phase-scenario-emoji { font-size: 50px; margin-bottom: 15px; display: block; }
        .phase-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            justify-content: center;
            margin-top: 20px;
        }
        .phase-btn {
            padding: 12px 20px;
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 12px;
            background: var(--bg-card);
            color: white;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 140px;
        }
        .phase-btn:hover {
            border-color: var(--yellow);
            transform: translateY(-3px);
            background: rgba(255,214,0,0.1);
        }
        .phase-btn.correct {
            background: rgba(67,160,71,0.3);
            border-color: var(--green);
            animation: correctPop 0.5s;
        }
        .phase-btn.wrong {
            background: rgba(229,57,53,0.3);
            border-color: var(--red);
            animation: shake 0.5s;
        }
        @keyframes correctPop {
            0% { transform: scale(1); }
            50% { transform: scale(1.15); }
            100% { transform: scale(1); }
        }

        /* ====== LEVEL 4: FORTSCHRITT VS REIFEGRAD ====== */
        .fvr-container {
            max-width: 650px;
            width: 95%;
            text-align: center;
        }
        .fvr-scenario {
            background: var(--bg-card);
            border: 2px solid var(--teal);
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
        }
        .fvr-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        .fvr-btn {
            padding: 20px 30px;
            border: 3px solid;
            border-radius: 15px;
            background: var(--bg-card);
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 200px;
        }
        .fvr-btn-fortschritt { border-color: var(--blue); }
        .fvr-btn-fortschritt:hover { background: rgba(30,136,229,0.2); transform: scale(1.05); }
        .fvr-btn-reifegrad { border-color: var(--purple); }
        .fvr-btn-reifegrad:hover { background: rgba(142,36,170,0.2); transform: scale(1.05); }

        /* ====== LEVEL 5: BOSS BATTLE ====== */
        .boss-container {
            max-width: 700px;
            width: 95%;
            text-align: center;
        }
        .boss-header {
            font-size: 14px;
            color: var(--red);
            animation: bossFlash 1s infinite;
            margin-bottom: 20px;
        }
        @keyframes bossFlash {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .boss-question {
            background: var(--bg-card);
            border: 2px solid var(--red);
            border-radius: 20px;
            padding: 25px;
            margin: 15px 0;
        }
        .boss-answers {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }
        .boss-answer {
            padding: 15px 20px;
            border: 2px solid rgba(255,255,255,0.15);
            border-radius: 12px;
            background: var(--bg-card);
            color: white;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
        }
        .boss-answer:hover {
            border-color: var(--yellow);
            background: rgba(255,214,0,0.05);
        }
        .boss-progress-bar {
            width: 100%;
            height: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 5px;
            margin: 15px 0;
            overflow: hidden;
        }
        .boss-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--red), var(--orange), var(--yellow));
            border-radius: 5px;
            transition: width 0.5s;
        }

        /* ====== RESULTS SCREEN ====== */
        #resultsScreen {
            background: linear-gradient(135deg, #0a1628, #1a2a4a);
        }
        .results-card {
            max-width: 600px;
            width: 95%;
            background: var(--bg-card);
            border: 2px solid var(--yellow);
            border-radius: 25px;
            padding: 40px;
            text-align: center;
            backdrop-filter: blur(10px);
        }
        .results-title {
            font-size: 28px;
            margin-bottom: 20px;
        }
        .results-score {
            font-size: 60px;
            font-weight: bold;
            color: var(--yellow);
            margin: 20px 0;
            text-shadow: 0 0 20px rgba(255,214,0,0.5);
        }
        .results-rank {
            font-size: 20px;
            color: var(--orange);
            margin: 15px 0;
        }
        .results-comment {
            font-size: 16px;
            line-height: 1.6;
            color: #ccc;
            margin: 20px 0;
        }
        .results-stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .stat-box {
            text-align: center;
            padding: 15px;
        }
        .stat-value { font-size: 30px; font-weight: bold; color: var(--teal-light); }
        .stat-label { font-size: 12px; color: #999; margin-top: 5px; }

        .trophy { font-size: 80px; animation: trophySpin 3s infinite; display: block; }
        @keyframes trophySpin {
            0%, 100% { transform: rotateY(0deg); }
            50% { transform: rotateY(180deg); }
        }

        /* ====== LEVEL INTRO ====== */
        .level-intro {
            text-align: center;
            max-width: 600px;
        }
        .level-intro h2 {
            font-size: clamp(18px, 3vw, 28px);
            color: var(--yellow);
            margin-bottom: 10px;
        }
        .level-intro p {
            font-size: clamp(13px, 2vw, 16px);
            color: #ccc;
            line-height: 1.6;
            margin: 10px 0;
        }
        .level-intro .level-number {
            font-size: 14px;
            color: var(--teal-light);
            margin-bottom: 5px;
        }
        .level-tip {
            background: rgba(255,152,0,0.1);
            border: 1px solid var(--orange);
            border-radius: 10px;
            padding: 12px 18px;
            font-size: 13px;
            color: var(--orange);
            margin: 15px 0;
            text-align: left;
        }

        /* ====== FEEDBACK POPUP ====== */
        .feedback {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: rgba(0,0,0,0.95);
            border: 3px solid var(--yellow);
            border-radius: 20px;
            padding: 30px 40px;
            text-align: center;
            z-index: 200;
            transition: transform 0.3s;
            max-width: 450px;
            width: 90%;
        }
        .feedback.show { transform: translate(-50%, -50%) scale(1); }
        .feedback-emoji { font-size: 60px; display: block; margin-bottom: 15px; }
        .feedback-text { font-size: 16px; line-height: 1.5; margin-bottom: 20px; }
        .feedback-score { color: var(--yellow); font-size: 24px; font-weight: bold; }

        /* ====== TRANSITION ====== */
        .transition-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: var(--bg-dark);
            z-index: 300;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s;
        }
        .transition-overlay.active { opacity: 1; pointer-events: all; }

        /* ====== MISC ====== */
        .glow-text {
            text-shadow: 0 0 10px currentColor;
        }
        .mt-10 { margin-top: 10px; }
        .mt-20 { margin-top: 20px; }
        .mt-30 { margin-top: 30px; }
        .mb-20 { margin-bottom: 20px; }
        .text-center { text-align: center; }

        .instruction-bar {
            background: rgba(0,137,123,0.2);
            border: 1px solid var(--teal);
            border-radius: 10px;
            padding: 10px 20px;
            margin: 10px 0;
            font-size: 13px;
            text-align: center;
            color: var(--teal-light);
        }

        /* Mobile adjustments */
        @media (max-width: 600px) {
            .role-cards { flex-direction: column; align-items: center; }
            .role-card { width: 90%; }
            .sort-container { flex-direction: column; align-items: center; }
            .sort-column { width: 90%; min-height: 200px; }
            .btn { padding: 12px 25px; font-size: 15px; }
            .btn-start { padding: 15px 30px; font-size: 11px; }
            .hud { padding: 8px 10px; }
            .hud-score, .hud-level { font-size: 11px; }
            .fvr-btn { min-width: 150px; padding: 15px 20px; font-size: 14px; }
            .game-area { height: min(400px, 55vh); }
        }

        /* Score popup animation */
        .score-popup {
            position: absolute;
            font-size: 20px;
            font-weight: bold;
            color: var(--yellow);
            pointer-events: none;
            animation: scoreFloat 1s forwards;
            z-index: 50;
        }
        @keyframes scoreFloat {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-60px) scale(1.5); }
        }

        .score-popup.negative { color: var(--red); }

        /* Ghost Characters */
        .ghost {
            display: inline-block;
            font-size: 24px;
            animation: ghostFloat 2s infinite ease-in-out;
            margin: 0 8px;
        }
        @keyframes ghostFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }

        .highlight-box {
            display: inline-block;
            background: rgba(255,214,0,0.15);
            border: 1px solid var(--yellow);
            border-radius: 8px;
            padding: 4px 10px;
            margin: 2px;
        }

        /* Progress dots for level intro */
        .progress-dots {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
        }
        .progress-dot {
            width: 14px; height: 14px;
            border-radius: 50%;
            border: 2px solid rgba(255,255,255,0.3);
            transition: all 0.3s;
        }
        .progress-dot.completed { background: var(--green); border-color: var(--green); }
        .progress-dot.current { background: var(--yellow); border-color: var(--yellow); box-shadow: 0 0 10px var(--yellow); }
        .progress-dot.upcoming { background: transparent; }

        /* Skip Button */
        .btn-skip {
            padding: 8px 22px;
            border: 2px dashed rgba(255,255,255,0.25);
            border-radius: 10px;
            background: transparent;
            color: #888;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 15px;
        }
        .btn-skip:hover {
            border-color: var(--orange);
            color: var(--orange);
            background: rgba(255,152,0,0.05);
        }
    </style>
</head>
<body>

<!-- PARTICLES BACKGROUND -->
<div class="particles" id="particles"></div>

<!-- HUD (hidden initially) -->
<div class="hud" id="hud" style="display:none;">
    <div class="hud-left">
        <div class="hud-level retro" id="hudLevel">Level 1</div>
        <div class="hud-score retro">‚≠ê <span id="hudScore">0</span></div>
    </div>
    <div class="hud-right">
        <div class="hud-lives" id="hudLives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
        <div class="hud-timer retro" id="hudTimer">60</div>
    </div>
</div>

<!-- TRANSITION OVERLAY -->
<div class="transition-overlay" id="transitionOverlay">
    <div class="retro" style="font-size: clamp(16px, 4vw, 32px); color: var(--yellow);" id="transitionText">Level 1</div>
    <div style="margin-top: 15px; color: var(--teal-light); font-size: 14px;" id="transitionSub"></div>
</div>

<!-- FEEDBACK POPUP -->
<div class="feedback" id="feedback">
    <span class="feedback-emoji" id="feedbackEmoji">üéâ</span>
    <div class="feedback-text" id="feedbackText">Super gemacht!</div>
    <div class="feedback-score" id="feedbackScore">+100</div>
    <button class="btn btn-primary btn-small mt-20" onclick="Game.closeFeedback()">Weiter</button>
</div>

<!-- ==================== SCREEN: TITLE ==================== -->
<div class="screen active" id="titleScreen">
    <div class="title-logo retro">KOMPASS MAN</div>
    <div class="title-subtitle retro">Das PHZH Strategie-Abenteuer</div>

    <div class="kompass-man">
        <div class="km-cape"></div>
        <div class="km-body">
            <div class="km-mouth"></div>
            <div class="km-eye"></div>
        </div>
        <div class="km-compass">
            <div class="km-needle"></div>
        </div>
    </div>

    <div style="margin: 10px 0; color: #999; font-size: 13px; text-align: center; max-width: 400px;">
        Lerne den PHZH-Kompass kennen ‚Äì von Initiativen bis Massnahmen.<br>
        <span style="color: var(--orange);">Und ja, es wird lustig. Versprochen. üòè</span>
    </div>

    <button class="btn btn-yellow btn-start mt-20" onclick="Game.startStory()">
        ‚ñ∂ START
    </button>

    <div style="margin-top: 30px; font-size: 11px; color: #555;">
        <span class="ghost">üëª</span> B√ºrokratius
        <span class="ghost">üëπ</span> Meeting-Monster
        <span class="ghost">üßü</span> Excel-Geist
        <span class="ghost">ü§ñ</span> Silo-Schreck
    </div>
</div>

<!-- ==================== SCREEN: STORY ==================== -->
<div class="screen" id="storyScreen">
    <div class="story-box">
        <span class="story-emoji" id="storyEmoji">üèõÔ∏è</span>
        <div class="story-text" id="storyText">Loading...</div>
        <div class="story-counter" id="storyCounter">1 / 5</div>
    </div>
    <div style="display: flex; gap: 15px; margin-top: 20px;">
        <button class="btn btn-primary btn-small" id="storyBackBtn" onclick="Game.prevStory()" style="display:none;">‚Üê Zur√ºck</button>
        <button class="btn btn-yellow btn-small" onclick="Game.nextStory()">Weiter ‚Üí</button>
    </div>
</div>

<!-- ==================== SCREEN: ROLE SELECTION ==================== -->
<div class="screen" id="roleScreen">
    <h2 class="retro" style="color: var(--yellow); font-size: clamp(14px, 3vw, 22px); margin-bottom: 5px;">W√§hle deine Rolle</h2>
    <p style="color: #999; font-size: 14px; margin-bottom: 10px;">Beide sind wichtig. Beide trinken viel Kaffee. ‚òï</p>

    <div class="role-cards">
        <div class="role-card" onclick="Game.selectRole('owner')" id="roleOwner">
            <div class="role-icon">üëë</div>
            <div class="role-title">Owner</div>
            <div class="role-desc">
                Du tr√§gst die <strong style="color:var(--yellow)">strategische Gesamtverantwortung</strong> f√ºr eine Initiative.
                Du siehst das grosse Ganze und sagst, wohin die Reise geht.
            </div>
            <div class="role-joke">
                "Wenn's klappt, war es Teamwork.<br>Wenn nicht, warst du es." üòÖ
            </div>
        </div>

        <div class="role-card" onclick="Game.selectRole('manager')" id="roleManager">
            <div class="role-icon">‚öôÔ∏è</div>
            <div class="role-title">Manager</div>
            <div class="role-desc">
                Du steuerst <strong style="color:var(--yellow)">operativ die Aktivit√§ten</strong>.
                Du weisst, wer was macht, wann es f√§llig ist und wo es hakt.
            </div>
            <div class="role-joke">
                "Alle kommen zu dir, wenn sie<br>nicht weiterwissen. Immer." ü§∑
            </div>
        </div>
    </div>
    <button class="btn btn-yellow mt-20" id="roleConfirmBtn" onclick="Game.confirmRole()" style="display:none;">Los geht's! üöÄ</button>
</div>

<!-- ==================== SCREEN: LEVEL INTROS (reused) ==================== -->
<div class="screen" id="levelIntroScreen">
    <div class="level-intro">
        <div class="progress-dots" id="progressDots"></div>
        <div class="level-number retro" id="levelIntroNumber">Level 1 von 5</div>
        <h2 id="levelIntroTitle">Strukturen-Sprint</h2>
        <p id="levelIntroDesc">Beschreibung</p>
        <div class="level-tip" id="levelIntroTip">üí° Tipp</div>
        <button class="btn btn-yellow mt-30" onclick="Game.startLevel()">Spielen! üéÆ</button>
    </div>
</div>

<!-- ==================== SCREEN: LEVEL 1 - CATCH GAME ==================== -->
<div class="screen" id="level1Screen">
    <div class="instruction-bar" id="level1Instruction">
        Bewege den aktiven Eimer mit ‚Üê ‚Üí oder tippe links/rechts. Wechsle Eimer mit 1, 2, 3.
    </div>
    <div class="game-area" id="catchArea">
        <div class="catch-bucket bucket-initiative bucket-active" id="bucket0" data-type="initiative">
            üèõÔ∏è Initiative
        </div>
        <div class="catch-bucket bucket-aktivitaet" id="bucket1" data-type="aktivitaet">
            üìã Aktivit√§t
        </div>
        <div class="catch-bucket bucket-massnahme" id="bucket2" data-type="massnahme">
            üîß Massnahme
        </div>
    </div>
    <button class="btn-skip mt-10" onclick="Game.skipLevel1()">üèÉ Level √ºberspringen ‚Äì ich fang lieber gar nichts!</button>
</div>

<!-- ==================== SCREEN: LEVEL 2 - DRAG SORT ==================== -->
<div class="screen" id="level2Screen">
    <div class="instruction-bar">
        Ziehe die Begriffe in die richtige Spalte! Wo geh√∂ren sie hin? ü§î
    </div>
    <div class="sort-container" id="sortContainer">
        <div class="sort-column sort-column-init" id="sortColInit" data-accept="initiative">
            <div class="sort-column-header">üèõÔ∏è Initiative<br><small>Strategisch</small></div>
            <div class="sort-dropzone" id="dropInit"></div>
        </div>
        <div class="sort-column sort-column-akt" id="sortColAkt" data-accept="aktivitaet">
            <div class="sort-column-header">üìã Aktivit√§t<br><small>Steuerung</small></div>
            <div class="sort-dropzone" id="dropAkt"></div>
        </div>
        <div class="sort-column sort-column-mass" id="sortColMass" data-accept="massnahme">
            <div class="sort-column-header">üîß Massnahme<br><small>Umsetzung</small></div>
            <div class="sort-dropzone" id="dropMass"></div>
        </div>
    </div>
    <div id="sortItemsPool" style="display:flex; flex-wrap:wrap; gap:10px; justify-content:center; margin-top:20px; max-width:900px;"></div>
    <button class="btn-skip mt-10" onclick="Game.skipLevel2()">üèÉ Level √ºberspringen ‚Äì Zuordnung ist nicht mein Ding!</button>
</div>

<!-- ==================== SCREEN: LEVEL 3 - PHASE QUIZ ==================== -->
<div class="screen" id="level3Screen">
    <div class="phase-card">
        <div style="font-size:12px; color:var(--teal-light);" id="phaseCounter">Szenario 1 / 6</div>
        <div class="phase-scenario-emoji" id="phaseEmoji">üìù</div>
        <div class="phase-scenario" id="phaseScenario">Loading...</div>
        <div style="font-size:13px; color:#999; margin-bottom:10px;">In welcher Phase ist diese Massnahme?</div>
        <div class="phase-buttons" id="phaseButtons">
            <button class="phase-btn" onclick="Game.checkPhase('geplant')">üìù Geplant</button>
            <button class="phase-btn" onclick="Game.checkPhase('umsetzung')">üöß In Umsetzung</button>
            <button class="phase-btn" onclick="Game.checkPhase('wiederkehrend')">üîÑ Wiederkehrend</button>
            <button class="phase-btn" onclick="Game.checkPhase('abgeschlossen')">‚úÖ Abgeschlossen</button>
        </div>
        <button class="btn-skip" onclick="Game.skipPhase()">üèÉ √úberspringen ‚Äì keine Ahnung!</button>
    </div>
</div>

<!-- ==================== SCREEN: LEVEL 4 - FORTSCHRITT VS REIFEGRAD ==================== -->
<div class="screen" id="level4Screen">
    <div class="fvr-container">
        <h2 class="retro" style="color:var(--yellow); font-size:clamp(12px,2.5vw,18px); margin-bottom:5px;">
            Fortschritt oder Reifegrad?
        </h2>
        <p style="color:#999; font-size:13px; margin-bottom:15px;">
            Diese Unterscheidung ist der Schl√ºssel zum Kompass-Verst√§ndnis! üîë
        </p>
        <div style="font-size:12px; color:var(--teal-light); margin-bottom:10px;" id="fvrCounter">1 / 8</div>
        <div class="fvr-scenario">
            <div style="font-size:50px;" id="fvrEmoji">ü§î</div>
            <div style="font-size:17px; line-height:1.6; margin:15px 0;" id="fvrText">Loading...</div>
        </div>
        <div class="fvr-buttons mt-20">
            <button class="fvr-btn fvr-btn-fortschritt" onclick="Game.checkFvr('fortschritt')">
                üìä Fortschritt<br><small style="font-weight:normal">Wurde es umgesetzt?</small>
            </button>
            <button class="fvr-btn fvr-btn-reifegrad" onclick="Game.checkFvr('reifegrad')">
                üèóÔ∏è Reifegrad<br><small style="font-weight:normal">Ist es verankert?</small>
            </button>
        </div>
        <button class="btn-skip mt-10" onclick="Game.skipFvr()">üèÉ √úberspringen ‚Äì ich rate lieber nicht!</button>
    </div>
</div>

<!-- ==================== SCREEN: LEVEL 5 - BOSS BATTLE ==================== -->
<div class="screen" id="level5Screen">
    <div class="boss-container">
        <div class="boss-header retro">
            ‚ö†Ô∏è BOSS-LEVEL: DER JAHRESREVIEW ‚ö†Ô∏è
        </div>
        <p style="color:#ccc; font-size:13px; margin-bottom:10px;">
            Die Hochschulleitung will wissen, ob du den Kompass beherrschst! üò∞
        </p>
        <div class="boss-progress-bar">
            <div class="boss-progress-fill" id="bossProgress" style="width:0%"></div>
        </div>
        <div style="font-size:12px; color:var(--teal-light); margin-bottom:10px;" id="bossCounter">Frage 1 / 10</div>
        <div class="boss-question">
            <div style="font-size:16px; line-height:1.5;" id="bossQuestion">Loading...</div>
        </div>
        <div class="boss-answers" id="bossAnswers"></div>
        <button class="btn-skip mt-10" onclick="Game.skipBoss()">üèÉ √úberspringen ‚Äì die GL muss warten!</button>
    </div>
</div>

<!-- ==================== SCREEN: RESULTS ==================== -->
<div class="screen" id="resultsScreen">
    <div class="results-card">
        <span class="trophy" id="resultsTrophy">üèÜ</span>
        <div class="results-title">Spiel beendet!</div>
        <div class="results-score" id="resultsScore">0</div>
        <div style="color:#999; font-size:14px;">Punkte</div>
        <div class="results-rank" id="resultsRank">Kompass-Kenner*in</div>
        <div class="results-comment" id="resultsComment">Gut gemacht!</div>
        <div class="results-stats" id="resultsStats"></div>
        <button class="btn btn-yellow mt-20" onclick="Game.restart()">üîÑ Nochmal spielen!</button>
    </div>
</div>

<script>
// ========================================================================
//  KOMPASS MAN - THE GAME
// ========================================================================

const Game = {
    score: 0,
    lives: 3,
    role: null,
    currentLevel: 0,
    storyIndex: 0,
    levelScores: [0, 0, 0, 0, 0],
    timerInterval: null,
    timeLeft: 0,

    // ---- STORY DATA ----
    stories: [
        {
            emoji: 'üèõÔ∏è',
            text: `Willkommen bei der <strong>PHZH</strong>! Hier werden nicht nur Lehrpersonen ausgebildet, sondern auch <strong>Strategien geschmiedet</strong>.<br><br>Aber wie beh√§lt man bei 9 Initiativen, 33 Aktivit√§ten und 118 Massnahmen den √úberblick?<br><br><em>Spoiler: Nicht mit Post-its. Haben wir versucht.</em> üò¨`
        },
        {
            emoji: 'üß≠',
            text: `Hier kommt der <strong>Kompass</strong> ins Spiel! Unser strategisches Steuerungstool.<br><br>Stell dir eine Pyramide vor:<br>üî∫ <strong>Initiativen</strong> ‚Äì die grossen strategischen Ziele<br>üî∑ <strong>Aktivit√§ten</strong> ‚Äì die konkreten Handlungsfelder<br>üî∂ <strong>Massnahmen</strong> ‚Äì die tats√§chlichen To-dos<br><br><em>"Endlich mehr als eine Excel-Liste!" ‚Äì Alle. Immer.</em> üìä`
        },
        {
            emoji: 'üëë',
            text: `Jede <strong>Initiative</strong> hat einen <strong>Owner</strong> ‚Äì die Person mit der Gesamtverantwortung.<br><br>Und einen oder mehrere <strong>Manager</strong> ‚Äì die operativen Held*innen im Hintergrund.<br><br>Der Owner sagt wo's langgeht.<br>Der Manager sorgt daf√ºr, dass man auch ankommt.<br><br><em>"Wie Batman und Alfred. Nur mit mehr Meetings."</em> ü¶á`
        },
        {
            emoji: 'üìä',
            text: `Zwei magische Begriffe musst du kennen:<br><br>üìà <strong>Fortschritt</strong> = Wurde etwas umgesetzt?<br>üèóÔ∏è <strong>Reifegrad</strong> = Ist es organisatorisch verankert?<br><br>Man kann ein Tool <em>komplett installiert</em> haben (hoher Fortschritt), aber niemand nutzt es (niedriger Reifegrad).<br><br><em>"Wie ein Fitnessabo im Januar."</em> üèãÔ∏è`
        },
        {
            emoji: 'üéÆ',
            text: `Genug Theorie! Zeit f√ºr <strong>Action</strong>! üí™<br><br>In 5 Levels lernst du den Kompass kennen:<br><br>üéØ Level 1: <strong>Strukturen-Sprint</strong> ‚Äì Fange die richtigen Elemente!<br>üß© Level 2: <strong>Zuordnungs-Chaos</strong> ‚Äì Sortiere die Begriffe!<br>‚ö° Level 3: <strong>Phasen-Poker</strong> ‚Äì Erkenne die richtige Phase!<br>üß† Level 4: <strong>Fortschritt vs. Reifegrad</strong> ‚Äì DER Unterschied!<br>üëπ Level 5: <strong>Boss-Level</strong> ‚Äì Der Jahresreview!<br><br><em>Bereit? Dann w√§hle deine Rolle!</em> üöÄ`
        }
    ],

    // ---- LEVEL DATA ----
    levels: [
        {
            title: 'Strukturen-Sprint',
            desc: 'Elemente fallen vom Himmel! Fange sie mit dem richtigen Eimer auf. Initiativen in den gr√ºnen, Aktivit√§ten in den blauen, Massnahmen in den orangen Eimer!',
            tip: 'üí° Tipp: Beweg den aktiven Eimer mit ‚Üê ‚Üí Pfeiltasten. Wechsle den aktiven Eimer mit den Tasten 1, 2, 3. Auf dem Handy: Tippe links/rechts zum Bewegen, tippe auf einen Eimer zum Wechseln.',
            number: 'Level 1 von 5'
        },
        {
            title: 'Zuordnungs-Chaos',
            desc: 'Ein Haufen Begriffe liegt vor dir. Ziehe jeden Begriff in die richtige Spalte! Ist es eine Initiative, eine Aktivit√§t oder eine Massnahme?',
            tip: 'üí° Tipp: Initiativen sind strategische √úberthemen. Aktivit√§ten sind Handlungsfelder. Massnahmen sind konkrete Aufgaben mit Verantwortlichen.',
            number: 'Level 2 von 5'
        },
        {
            title: 'Phasen-Poker',
            desc: 'Jede Massnahme durchl√§uft Phasen. Lies das Szenario und w√§hle die richtige Phase!',
            tip: 'üí° Tipp: Geplant ‚Üí In Umsetzung ‚Üí Wiederkehrend ‚Üí Abgeschlossen. Nicht jede Massnahme durchl√§uft alle Phasen!',
            number: 'Level 3 von 5'
        },
        {
            title: 'Fortschritt oder Reifegrad?',
            desc: 'DER Unterschied, den du kennen musst! Fortschritt = Umsetzungsgrad. Reifegrad = Organisatorische Verankerung. Lies die Szenarien und entscheide!',
            tip: 'üí° Tipp: Frag dich: Geht es um "wurde es gemacht?" (Fortschritt) oder "ist es im Alltag integriert?" (Reifegrad)',
            number: 'Level 4 von 5'
        },
        {
            title: 'Der Jahresreview',
            desc: 'Die Hochschulleitung pr√ºft dein Kompass-Wissen! 10 Fragen, schnell hintereinander. Zeig, was du gelernt hast!',
            tip: 'üí° Tipp: Alles, was du bisher gelernt hast, kommt jetzt zusammen. Keine Panik ‚Äì du schaffst das! (Wahrscheinlich.) üòÖ',
            number: 'BOSS-Level'
        }
    ],

    // ---- CATCH GAME ITEMS ----
    catchItems: [
        { text: 'üèõÔ∏è Digitalisierung vorantreiben', type: 'initiative' },
        { text: 'üèõÔ∏è Infrastruktur optimieren', type: 'initiative' },
        { text: 'üèõÔ∏è IT-Service verbessern', type: 'initiative' },
        { text: 'üèõÔ∏è Innovationsmanagement', type: 'initiative' },
        { text: 'üìã Fl√§chenmanagement', type: 'aktivitaet' },
        { text: 'üìã Fl√§chenplanung', type: 'aktivitaet' },
        { text: 'üìã KI-Anwendungen', type: 'aktivitaet' },
        { text: 'üìã Dienstleistungsportfolio', type: 'aktivitaet' },
        { text: 'üîß Tool evaluieren', type: 'massnahme' },
        { text: 'üîß Konzept erstellen', type: 'massnahme' },
        { text: 'üîß Schulung durchf√ºhren', type: 'massnahme' },
        { text: 'üîß Raumbelegung pr√ºfen', type: 'massnahme' },
        { text: '‚òï Kaffeepause!', type: 'distraction' },
        { text: 'üìß 248 E-Mails', type: 'distraction' },
        { text: 'üóìÔ∏è Meeting um 9:00', type: 'distraction' },
        { text: 'üçï Pizza bestellen?', type: 'distraction' },
        { text: 'üò¥ Kurz die Augen zu', type: 'distraction' },
        { text: 'üì± Instagram checken', type: 'distraction' },
    ],

    // ---- SORT ITEMS ----
    sortItems: [
        { text: 'Optimierung der Infrastruktur-Nutzung', type: 'initiative', hint: 'Strategische Klammer' },
        { text: 'Systematisierung Digitalisierung & KI', type: 'initiative', hint: 'Strategisches Ziel' },
        { text: 'Weiterentwicklung IT-Servicemanagement', type: 'initiative', hint: 'Strategisches Ziel' },
        { text: 'Fl√§chenmanagement verbessern', type: 'aktivitaet', hint: 'Handlungsfeld' },
        { text: 'Langfristige Fl√§chenplanung', type: 'aktivitaet', hint: 'Handlungsfeld' },
        { text: 'Nutzungsfreundliche Infrastruktur', type: 'aktivitaet', hint: 'Handlungsfeld' },
        { text: 'Verdichtungspotenziale identifizieren', type: 'massnahme', hint: 'Konkrete Aufgabe' },
        { text: 'Nutzungsintensit√§t erh√∂hen', type: 'massnahme', hint: 'Konkrete Aufgabe' },
        { text: 'Raummonitoring aufbauen', type: 'massnahme', hint: 'Konkrete Aufgabe' },
    ],

    // ---- PHASE SCENARIOS ----
    phaseScenarios: [
        {
            emoji: 'üìù',
            text: 'Das Konzept f√ºr ein neues Raummonitoring wurde geschrieben und genehmigt. Die Umsetzung beginnt n√§chsten Monat.',
            answer: 'geplant',
            joke: 'Genau! Noch ist alles Theorie. Wie Neujahrsvors√§tze im Januar.'
        },
        {
            emoji: 'üöß',
            text: 'Das Team installiert gerade die neue Software f√ºr die Raumbelegungserfassung. Erste Tests laufen.',
            answer: 'umsetzung',
            joke: 'Richtig! Mittendrin statt nur dabei. Wie eine Baustelle auf der Autobahn ‚Äì es wird, es dauert.'
        },
        {
            emoji: '‚úÖ',
            text: 'Die Verdichtungspotenziale wurden vollst√§ndig identifiziert. Der Bericht liegt vor und wurde abgenommen.',
            answer: 'abgeschlossen',
            joke: 'Korrekt! Fertig! Done! Finito! Ab in die "erledigt"-Spalte damit! üéâ'
        },
        {
            emoji: 'üîÑ',
            text: 'Das Raummonitoring l√§uft seit einem Jahr. Jeden Monat werden die Daten erfasst und ausgewertet.',
            answer: 'wiederkehrend',
            joke: 'Genau! Wie Z√§hneputzen ‚Äì muss man regelm√§ssig machen, auch wenn\'s keiner sieht.'
        },
        {
            emoji: 'üìù',
            text: 'Die Hochschulleitung hat beschlossen, die Nutzungsregeln f√ºr Seminarr√§ume zu √ºberarbeiten. Es gibt noch keinen Zeitplan.',
            answer: 'geplant',
            joke: 'Richtig! "Beschlossen" heisst noch lange nicht "gemacht". Das kennen wir alle.'
        },
        {
            emoji: 'üöß',
            text: 'Die Umfrage zur Raumzufriedenheit wurde verschickt. Die ersten 47% haben geantwortet.',
            answer: 'umsetzung',
            joke: 'Stimmt! Halb fertig. Wie ein Puzzle an Weihnachten ‚Äì man weiss, es wird irgendwann.'
        },
        {
            emoji: 'üîÑ',
            text: 'Jeden Freitag erstellt das FM-Team automatisch einen Bericht √ºber die Auslastung aller R√§ume.',
            answer: 'wiederkehrend',
            joke: 'Genau! Freitags-Routine. Rechtzeitig vor dem Wochenende! üéâ'
        },
        {
            emoji: '‚úÖ',
            text: 'Das Projekt "Neue Beschilderung" ist abgeschlossen. Alle R√§ume haben neue digitale T√ºrschilder.',
            answer: 'abgeschlossen',
            joke: 'Richtig! Sogar die T√ºrschilder sind jetzt digital. Willkommen in der Zukunft! üö™‚ú®'
        }
    ],

    // ---- FORTSCHRITT VS REIFEGRAD ----
    fvrScenarios: [
        {
            emoji: 'üíª',
            text: 'Ein neues Buchungssystem f√ºr R√§ume wurde vollst√§ndig implementiert und steht allen zur Verf√ºgung.',
            answer: 'fortschritt',
            explain: 'Das System wurde umgesetzt ‚Äì das ist FORTSCHRITT. Ob es auch alle nutzen? Das w√§re Reifegrad!',
            joke: '"Installiert" heisst nicht "benutzt". Frag mal dein Fitnessstudio.'
        },
        {
            emoji: 'üè¢',
            text: 'Das Raumbuchungssystem wird von 95% aller Abteilungen aktiv im Tagesgesch√§ft genutzt und ist in den Standardprozess integriert.',
            answer: 'reifegrad',
            explain: 'Es ist organisatorisch verankert ‚Äì das ist REIFEGRAD. Nicht nur implementiert, sondern gelebt!',
            joke: 'Wow, 95%! Die anderen 5% buchen noch per Zuruf. Classic.'
        },
        {
            emoji: 'üìä',
            text: 'Der Bericht zur Raumauslastung wurde erstmals erstellt und der Hochschulleitung pr√§sentiert.',
            answer: 'fortschritt',
            explain: 'Ein konkreter Meilenstein wurde erreicht ‚Äì FORTSCHRITT!',
            joke: 'Der Bericht existiert! Ob ihn jemand gelesen hat, ist eine andere Frage... üìöüòÖ'
        },
        {
            emoji: 'üîÑ',
            text: 'Die monatliche Auslastungsanalyse ist ein fester Bestandteil der GL-Sitzung und fliesst automatisch in die Entscheide ein.',
            answer: 'reifegrad',
            explain: 'Das ist in die Organisation eingebettet ‚Äì REIFEGRAD!',
            joke: 'Integration in die GL-Sitzung? Das ist quasi der Ritterschlag f√ºr jedes Reporting! ‚öîÔ∏è'
        },
        {
            emoji: 'üõí',
            text: '3 von 5 geplanten Sensoren f√ºr die Raumbelegungsmessung wurden bestellt und geliefert.',
            answer: 'fortschritt',
            explain: '3 von 5 = 60% Umsetzung. Das ist reiner FORTSCHRITT!',
            joke: '60% bestellt. 0% angeschlossen. 100% Lieferscheine archiviert. üì¶'
        },
        {
            emoji: 'üéì',
            text: 'Alle Mitarbeitenden der Verwaltung haben die Schulung zum neuen Raumbuchungstool absolviert UND nutzen es eigenst√§ndig im Alltag.',
            answer: 'reifegrad',
            explain: 'Geschult + selbstst√§ndig genutzt = organisatorisch verankert = REIFEGRAD!',
            joke: 'Schulung UND Nutzung? Das ist wie wenn Leute ihre Neujahresvors√§tze wirklich einhalten. Selten, aber m√∂glich! üåü'
        },
        {
            emoji: 'üìã',
            text: 'Das Konzept f√ºr die neue Raumstrategie 2027 ist fertiggeschrieben und vom Steuerungsausschuss genehmigt.',
            answer: 'fortschritt',
            explain: 'Konzept fertig + genehmigt = ein Meilenstein erreicht = FORTSCHRITT!',
            joke: 'Genehmigt! üéâ Jetzt nur noch umsetzen. Easy. (Spoiler: Ist es nie.)'
        },
        {
            emoji: 'üèóÔ∏è',
            text: 'Die KPIs f√ºr Raumnutzung sind definiert und werden automatisch erhoben, aber die Ergebnisse werden noch nicht f√ºr Entscheidungen genutzt.',
            answer: 'fortschritt',
            explain: 'Implementiert, aber nicht verankert. Das ist FORTSCHRITT ohne vollen REIFEGRAD!',
            joke: 'Die Daten sind da, aber keiner schaut hin. Wie eine √úberwachungskamera, die auf die Wand zeigt. üìπ'
        }
    ],

    // ---- BOSS QUESTIONS ----
    bossQuestions: [
        {
            q: 'Wie heisst die strategische Klammer im Kompass?',
            answers: ['Massnahme', 'Aktivit√§t', 'Initiative', 'PowerPoint-Folie'],
            correct: 2,
            joke: 'Richtig! Nicht die PowerPoint-Folie ‚Äì auch wenn sie sich manchmal so anf√ºhlt. üòÑ'
        },
        {
            q: 'Wer tr√§gt die Gesamtverantwortung f√ºr eine Initiative?',
            answers: ['Der Manager', 'Der Owner', 'Der Praktikant', 'ChatGPT'],
            correct: 1,
            joke: 'Genau, der Owner! ChatGPT ist aber ein starker Zweitplatzierter. ü§ñ'
        },
        {
            q: 'Welche Beziehung besteht zwischen Initiative und Aktivit√§ten?',
            answers: ['1:1', '1:n', 'n:m', 'Es ist kompliziert (Facebook-Status)'],
            correct: 1,
            joke: 'Eine Initiative, viele Aktivit√§ten. Wie eine WhatsApp-Gruppe: Einer thematisiert, alle machen mit.'
        },
        {
            q: 'Was wird auf Ebene der Aktivit√§t NICHT bewertet?',
            answers: ['Fortschritt', 'Reifegrad', 'Budget', 'Sowohl Fortschritt als auch Reifegrad'],
            correct: 2,
            joke: 'Budget wird (noch) nicht im Kompass bewertet. Da sind wir alle erleichtert. üí∏'
        },
        {
            q: 'Welche Phase gibt es bei Massnahmen NICHT?',
            answers: ['Geplant', 'In Umsetzung', 'In Panik', 'Abgeschlossen'],
            correct: 2,
            joke: '"In Panik" ist keine offizielle Phase, auch wenn sie sich manchmal so anf√ºhlt. üò±'
        },
        {
            q: 'Ein Tool wurde installiert, aber niemand nutzt es. Was ist hoch?',
            answers: ['Reifegrad', 'Fortschritt', 'Beides', 'Weder noch'],
            correct: 1,
            joke: 'Hoher Fortschritt (installiert!), niedriger Reifegrad (nutzt keiner). Wie ein Hometrainer als Kleiderst√§nder. üö¥'
        },
        {
            q: 'Worauf bezieht sich die Stufe "Etabliert"?',
            answers: ['Fortschritt', 'Reifegrad', 'Massnahmen-Phase', 'Karrierestufe'],
            correct: 1,
            joke: 'Etabliert ist eine Stufe des Reifegrads. (Und leider keine Karrierestufe, sorry! üòÖ)'
        },
        {
            q: 'Was hat jede Massnahme?',
            answers: ['Einen Verantwortlichen und eine Phase', 'Ein Budget und einen Sponsor', 'Einen Gantt-Chart', 'Ein eigenes Meeting'],
            correct: 0,
            joke: 'Verantwortlicher + Phase! Kein eigenes Meeting ‚Äì davon gibt es schon genug. üìÖ'
        },
        {
            q: 'Wie viele Stufen hat der Reifegrad?',
            answers: ['3', '4', '5', 'Unendlich viele (wie Meetings)'],
            correct: 2,
            joke: '5 Stufen: Initial ‚Üí Strukturiert ‚Üí Etabliert ‚Üí Gesteuert ‚Üí Optimiert. Nicht unendlich ‚Äì anders als Meetings. üòÇ'
        },
        {
            q: 'Was beschreibt der Fortschritt am besten?',
            answers: ['Wie innovativ eine Aktivit√§t ist', 'Wie weit die Umsetzung gediehen ist', 'Wie beliebt das Thema ist', 'Wie oft es in Meetings erw√§hnt wird'],
            correct: 1,
            joke: 'Der Fortschritt = wie weit man ist. Nicht wie oft man dar√ºber redet. Sonst w√§ren alle bei 100%. üó£Ô∏è'
        }
    ],

    // ---- FUNNY MESSAGES ----
    funnyCorrect: [
        'Perfekt! Du bist ein Naturtalent! üåü',
        'Genau richtig! Die Strategie-G√∂tter sind stolz! ‚ö°',
        'Boom! Volltreffer! üí•',
        'Korrekt! Hast du vorher heimlich ge√ºbt? ü§ì',
        'Richtig! Du bist auf dem Weg zum Kompass-Guru! üßò',
        'Jawoll! Das war schneller als ein Hot-Fix am Freitag! üî•',
        'Stimmt! Du machst das besser als manche F√ºhrungskraft! üòè',
        'Top! Noch so einer und du kannst Owner werden! üëë',
    ],

    funnyWrong: [
        'Nicht ganz... Aber hey, Trial and Error ist auch eine Strategie! üîÑ',
        'Ups! So verirrt wie ein Post-it auf dem Weg ins Homeoffice. üìå',
        'Hmm, das war so daneben wie eine Strategie ohne Budget. üí∏',
        'Nope! Aber keine Sorge ‚Äì auch Rom wurde nicht an einem Meeting gebaut. üèõÔ∏è',
        'Fast! So nah dran wie "Wir sind fast fertig" beim Projekt. ü§•',
        'Das war wie Copy-Paste ins falsche Dokument. üìãüòÖ',
        'Leider falsch! Aber du bist trotzdem eingeladen zum n√§chsten Meeting. üìÖ',
        'Nicht ganz! Tr√∂ste dich: Selbst Excel macht manchmal Fehler. üìä',
    ],

    // ========================================================================
    //  INIT
    // ========================================================================
    init() {
        this.createParticles();
        this.setupKeyboard();
        this.setupTouch();
    },

    createParticles() {
        const container = document.getElementById('particles');
        const colors = ['var(--teal)', 'var(--yellow)', 'var(--blue)', 'var(--orange)'];
        for (let i = 0; i < 20; i++) {
            const p = document.createElement('div');
            p.className = 'particle';
            p.style.width = p.style.height = Math.random() * 20 + 5 + 'px';
            p.style.left = Math.random() * 100 + '%';
            p.style.top = Math.random() * 100 + '%';
            p.style.background = colors[Math.floor(Math.random() * colors.length)];
            p.style.animationDelay = Math.random() * 15 + 's';
            p.style.animationDuration = 10 + Math.random() * 20 + 's';
            container.appendChild(p);
        }
    },

    // ========================================================================
    //  SCREEN MANAGEMENT
    // ========================================================================
    showScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    },

    showTransition(text, sub, callback) {
        const overlay = document.getElementById('transitionOverlay');
        document.getElementById('transitionText').textContent = text;
        document.getElementById('transitionSub').textContent = sub || '';
        overlay.classList.add('active');
        setTimeout(() => {
            overlay.classList.remove('active');
            if (callback) callback();
        }, 1800);
    },

    showFeedback(emoji, text, score) {
        const fb = document.getElementById('feedback');
        document.getElementById('feedbackEmoji').textContent = emoji;
        document.getElementById('feedbackText').innerHTML = text;
        document.getElementById('feedbackScore').textContent = score >= 0 ? `+${score}` : `${score}`;
        document.getElementById('feedbackScore').style.color = score >= 0 ? 'var(--yellow)' : 'var(--red)';
        fb.classList.add('show');
    },

    closeFeedback() {
        document.getElementById('feedback').classList.remove('show');
        if (this._feedbackCallback) {
            const cb = this._feedbackCallback;
            this._feedbackCallback = null;
            cb();
        }
    },

    updateHud() {
        document.getElementById('hudScore').textContent = this.score;
        document.getElementById('hudLives').textContent = '‚ù§Ô∏è'.repeat(Math.max(0, this.lives));
        document.getElementById('hudLevel').textContent = `Level ${this.currentLevel + 1}`;
    },

    startTimer(seconds, onEnd) {
        this.timeLeft = seconds;
        const display = document.getElementById('hudTimer');
        display.textContent = this.timeLeft;
        display.style.background = 'var(--red)';

        if (this.timerInterval) clearInterval(this.timerInterval);
        this.timerInterval = setInterval(() => {
            this.timeLeft--;
            display.textContent = this.timeLeft;
            if (this.timeLeft <= 10) {
                display.style.background = '#FF1744';
                display.style.animation = 'bossFlash 0.5s infinite';
            }
            if (this.timeLeft <= 0) {
                clearInterval(this.timerInterval);
                display.style.animation = '';
                if (onEnd) onEnd();
            }
        }, 1000);
    },

    stopTimer() {
        if (this.timerInterval) {
            clearInterval(this.timerInterval);
            this.timerInterval = null;
        }
    },

    // ========================================================================
    //  STORY FLOW
    // ========================================================================
    startStory() {
        this.storyIndex = 0;
        this.showScreen('storyScreen');
        this.updateStory();
    },

    updateStory() {
        const s = this.stories[this.storyIndex];
        document.getElementById('storyEmoji').textContent = s.emoji;
        document.getElementById('storyText').innerHTML = s.text;
        document.getElementById('storyCounter').textContent = `${this.storyIndex + 1} / ${this.stories.length}`;
        document.getElementById('storyBackBtn').style.display = this.storyIndex > 0 ? '' : 'none';
    },

    nextStory() {
        this.storyIndex++;
        if (this.storyIndex >= this.stories.length) {
            this.showScreen('roleScreen');
        } else {
            this.updateStory();
        }
    },

    prevStory() {
        if (this.storyIndex > 0) {
            this.storyIndex--;
            this.updateStory();
        }
    },

    // ========================================================================
    //  ROLE SELECTION
    // ========================================================================
    selectRole(role) {
        this.role = role;
        document.querySelectorAll('.role-card').forEach(c => c.classList.remove('selected'));
        document.getElementById(role === 'owner' ? 'roleOwner' : 'roleManager').classList.add('selected');
        document.getElementById('roleConfirmBtn').style.display = '';
    },

    confirmRole() {
        if (!this.role) return;
        this.currentLevel = 0;
        this.score = 0;
        this.lives = 3;
        this.levelScores = [0, 0, 0, 0, 0];
        this.showLevelIntro(0);
    },

    // ========================================================================
    //  LEVEL INTRO
    // ========================================================================
    showLevelIntro(levelIdx) {
        this.currentLevel = levelIdx;
        const level = this.levels[levelIdx];
        document.getElementById('levelIntroNumber').textContent = level.number;
        document.getElementById('levelIntroTitle').textContent = level.title;
        document.getElementById('levelIntroDesc').textContent = level.desc;
        document.getElementById('levelIntroTip').innerHTML = level.tip;

        // Update progress dots
        const dots = document.getElementById('progressDots');
        dots.innerHTML = '';
        for (let i = 0; i < 5; i++) {
            const dot = document.createElement('div');
            dot.className = `progress-dot ${i < levelIdx ? 'completed' : i === levelIdx ? 'current' : 'upcoming'}`;
            dots.appendChild(dot);
        }

        this.showScreen('levelIntroScreen');
    },

    startLevel() {
        document.getElementById('hud').style.display = 'flex';
        this.updateHud();

        const levelFns = [
            () => this.startLevel1(),
            () => this.startLevel2(),
            () => this.startLevel3(),
            () => this.startLevel4(),
            () => this.startLevel5()
        ];
        levelFns[this.currentLevel]();
    },

    finishLevel(levelIdx, score) {
        this.stopTimer();
        this.levelScores[levelIdx] = score;
        this.score += score;
        this.updateHud();

        if (levelIdx < 4) {
            this._feedbackCallback = () => {
                this.showLevelIntro(levelIdx + 1);
            };
            const msgs = [
                'Level geschafft! Auf zur n√§chsten Herausforderung!',
                'Sehr gut! Du beherrschst die Zuordnung! Weiter geht\'s!',
                'Phasen-Profi! Jetzt kommt die K√∂nigsdisziplin!',
                'Fast geschafft! Nur noch der Boss wartet...',
            ];
            this.showFeedback('üéâ', msgs[levelIdx], score);
        } else {
            this.showResults();
        }
    },

    // ========================================================================
    //  LEVEL 1: CATCH GAME
    // ========================================================================
    catchState: { activeBucket: 0, items: [], areaW: 0, areaH: 0, spawnTimer: null, animFrame: null, score: 0, caught: 0 },

    startLevel1() {
        this.showScreen('level1Screen');
        const area = document.getElementById('catchArea');
        const cs = this.catchState;
        cs.activeBucket = 0;
        cs.items = [];
        cs.score = 0;
        cs.caught = 0;
        cs.areaW = area.clientWidth;
        cs.areaH = area.clientHeight;

        // Clear existing items
        area.querySelectorAll('.falling-item, .score-popup').forEach(el => el.remove());

        // Set bucket positions
        this.updateBucketHighlight();
        const bucketWidth = 120;
        const spacing = (cs.areaW - 3 * bucketWidth) / 4;
        for (let i = 0; i < 3; i++) {
            const bucket = document.getElementById(`bucket${i}`);
            bucket.style.left = (spacing + i * (bucketWidth + spacing)) + 'px';
        }

        this.startTimer(45, () => this.endLevel1());

        // Spawn items
        let spawnCount = 0;
        cs.spawnTimer = setInterval(() => {
            if (spawnCount < 24) {
                this.spawnCatchItem();
                spawnCount++;
            } else {
                clearInterval(cs.spawnTimer);
            }
        }, 1500);

        // Animation loop
        const animate = () => {
            this.updateCatchItems();
            cs.animFrame = requestAnimationFrame(animate);
        };
        cs.animFrame = requestAnimationFrame(animate);
    },

    spawnCatchItem() {
        const area = document.getElementById('catchArea');
        const cs = this.catchState;
        const item = this.catchItems[Math.floor(Math.random() * this.catchItems.length)];

        const el = document.createElement('div');
        el.className = `falling-item item-${item.type}`;
        el.textContent = item.text;
        el.dataset.type = item.type;

        const maxX = cs.areaW - 140;
        el.style.left = Math.random() * maxX + 'px';
        el.style.top = '-40px';
        el._speed = 1 + Math.random() * 1.5;
        el._y = -40;

        area.appendChild(el);
        cs.items.push(el);
    },

    updateCatchItems() {
        const cs = this.catchState;
        const area = document.getElementById('catchArea');

        for (let i = cs.items.length - 1; i >= 0; i--) {
            const el = cs.items[i];
            el._y += el._speed;
            el.style.top = el._y + 'px';

            // Check if caught
            if (el._y >= cs.areaH - 65) {
                const elRect = el.getBoundingClientRect();
                const elCenterX = elRect.left + elRect.width / 2;

                // Check all buckets
                const bucketTypes = ['initiative', 'aktivitaet', 'massnahme'];
                let caught = false;

                for (let b = 0; b < 3; b++) {
                    const bucket = document.getElementById(`bucket${b}`);
                    const bRect = bucket.getBoundingClientRect();

                    if (elCenterX >= bRect.left && elCenterX <= bRect.right) {
                        const itemType = el.dataset.type;
                        if (itemType === 'distraction') {
                            // Caught a distraction - bad!
                            this.showScorePopup(area, el._y, parseFloat(el.style.left), '-20 üòµ', true);
                            cs.score -= 20;
                            this.score = Math.max(0, this.score - 20);
                        } else if (itemType === bucketTypes[b]) {
                            // Correct bucket!
                            this.showScorePopup(area, el._y, parseFloat(el.style.left), '+25 ‚úÖ', false);
                            cs.score += 25;
                            this.score += 25;
                            cs.caught++;
                        } else {
                            // Wrong bucket
                            this.showScorePopup(area, el._y, parseFloat(el.style.left), '-10 ‚ùå', true);
                            cs.score -= 10;
                            this.score = Math.max(0, this.score - 10);
                        }
                        caught = true;
                        break;
                    }
                }

                if (!caught && el.dataset.type !== 'distraction') {
                    // Missed a non-distraction item
                    this.showScorePopup(area, el._y, parseFloat(el.style.left), 'Verpasst!', true);
                }

                // Remove item
                el.remove();
                cs.items.splice(i, 1);
                this.updateHud();
            }
        }
    },

    showScorePopup(container, y, x, text, isNeg) {
        const popup = document.createElement('div');
        popup.className = `score-popup ${isNeg ? 'negative' : ''}`;
        popup.textContent = text;
        popup.style.top = (y - 30) + 'px';
        popup.style.left = x + 'px';
        container.appendChild(popup);
        setTimeout(() => popup.remove(), 1000);
    },

    updateBucketHighlight() {
        for (let i = 0; i < 3; i++) {
            const b = document.getElementById(`bucket${i}`);
            b.classList.toggle('bucket-active', i === this.catchState.activeBucket);
        }
    },

    moveBucket(dir) {
        const cs = this.catchState;
        const bucket = document.getElementById(`bucket${cs.activeBucket}`);
        let left = parseFloat(bucket.style.left) || 0;
        const step = 30;
        left += dir * step;
        left = Math.max(0, Math.min(cs.areaW - 120, left));
        bucket.style.left = left + 'px';
    },

    endLevel1() {
        const cs = this.catchState;
        clearInterval(cs.spawnTimer);
        if (cs.animFrame) cancelAnimationFrame(cs.animFrame);
        cs.items.forEach(el => el.remove());
        cs.items = [];
        this.finishLevel(0, Math.max(0, cs.score));
    },

    skipLevel1() {
        this.stopTimer();
        const cs = this.catchState;
        clearInterval(cs.spawnTimer);
        if (cs.animFrame) cancelAnimationFrame(cs.animFrame);
        cs.items.forEach(el => el.remove());
        cs.items = [];
        this._feedbackCallback = () => this.showLevelIntro(1);
        this.showFeedback('üèÉ', this.getSkipMsg() + '<br><br><em style="color:#999">0 Punkte f√ºr dieses Level ‚Äì aber hey, wenigstens kein Stress!</em>', 0);
    },

    // ========================================================================
    //  LEVEL 2: DRAG & DROP SORT
    // ========================================================================
    sortState: { remaining: 0, score: 0, dragItem: null },

    startLevel2() {
        this.showScreen('level2Screen');
        const ss = this.sortState;
        ss.score = 0;

        // Clear drop zones
        ['dropInit', 'dropAkt', 'dropMass'].forEach(id => {
            document.getElementById(id).innerHTML = '';
        });

        // Shuffle and populate pool
        const pool = document.getElementById('sortItemsPool');
        pool.innerHTML = '';
        const shuffled = [...this.sortItems].sort(() => Math.random() - 0.5);
        ss.remaining = shuffled.length;

        shuffled.forEach((item, idx) => {
            const el = document.createElement('div');
            el.className = `sort-item sort-item-${item.type === 'initiative' ? 'init' : item.type === 'aktivitaet' ? 'akt' : 'mass'}`;
            el.textContent = item.text;
            el.dataset.type = item.type;
            el.dataset.idx = idx;
            el.draggable = true;
            el.title = item.hint;

            // Drag events
            el.addEventListener('dragstart', (e) => {
                e.dataTransfer.setData('text/plain', JSON.stringify({ type: item.type, idx: idx }));
                el.classList.add('dragging');
                ss.dragItem = el;
            });
            el.addEventListener('dragend', () => {
                el.classList.remove('dragging');
                ss.dragItem = null;
            });

            // Touch drag support
            el.addEventListener('touchstart', (e) => this.handleSortTouchStart(e, el, item));

            pool.appendChild(el);
        });

        // Setup drop zones
        ['sortColInit', 'sortColAkt', 'sortColMass'].forEach(id => {
            const col = document.getElementById(id);
            col.addEventListener('dragover', (e) => {
                e.preventDefault();
                col.classList.add('drop-highlight');
            });
            col.addEventListener('dragleave', () => col.classList.remove('drop-highlight'));
            col.addEventListener('drop', (e) => {
                e.preventDefault();
                col.classList.remove('drop-highlight');
                const data = JSON.parse(e.dataTransfer.getData('text/plain'));
                this.handleSort(data, col.dataset.accept);
            });
        });

        this.startTimer(60, () => this.endLevel2());
    },

    handleSortTouchStart(e, el, item) {
        e.preventDefault();
        const touch = e.touches[0];
        const ghost = el.cloneNode(true);
        ghost.style.position = 'fixed';
        ghost.style.zIndex = '1000';
        ghost.style.opacity = '0.8';
        ghost.style.pointerEvents = 'none';
        ghost.style.width = el.offsetWidth + 'px';
        document.body.appendChild(ghost);

        const moveHandler = (e2) => {
            const t = e2.touches[0];
            ghost.style.left = (t.clientX - 50) + 'px';
            ghost.style.top = (t.clientY - 20) + 'px';
        };

        const endHandler = (e2) => {
            ghost.remove();
            const t = e2.changedTouches[0];
            const target = document.elementFromPoint(t.clientX, t.clientY);

            if (target) {
                const col = target.closest('.sort-column');
                if (col) {
                    this.handleSort({ type: item.type, idx: parseInt(el.dataset.idx) }, col.dataset.accept);
                }
            }

            document.removeEventListener('touchmove', moveHandler);
            document.removeEventListener('touchend', endHandler);
        };

        document.addEventListener('touchmove', moveHandler, { passive: false });
        document.addEventListener('touchend', endHandler);
    },

    handleSort(data, acceptType) {
        const ss = this.sortState;
        const pool = document.getElementById('sortItemsPool');
        const item = pool.querySelector(`[data-idx="${data.idx}"]`);
        if (!item) return;

        if (data.type === acceptType) {
            // Correct!
            item.classList.add('sort-item-correct');
            item.draggable = false;
            item.style.cursor = 'default';
            const dropZone = document.getElementById(
                acceptType === 'initiative' ? 'dropInit' :
                acceptType === 'aktivitaet' ? 'dropAkt' : 'dropMass'
            );
            dropZone.appendChild(item);
            ss.score += 30;
            this.score += 30;
            ss.remaining--;
            this.updateHud();

            if (ss.remaining <= 0) {
                this.stopTimer();
                setTimeout(() => this.finishLevel(1, ss.score), 800);
            }
        } else {
            // Wrong!
            item.classList.add('sort-item-wrong');
            setTimeout(() => item.classList.remove('sort-item-wrong'), 600);
            ss.score -= 10;
            this.score = Math.max(0, this.score - 10);
            this.updateHud();
        }
    },

    endLevel2() {
        this.finishLevel(1, Math.max(0, this.sortState.score));
    },

    skipLevel2() {
        this.stopTimer();
        this._feedbackCallback = () => this.showLevelIntro(2);
        this.showFeedback('üèÉ', this.getSkipMsg() + '<br><br><em style="color:#999">0 Punkte ‚Äì Sortieren kann man auch im echten Leben noch √ºben!</em>', 0);
    },

    // ========================================================================
    //  LEVEL 3: PHASE QUIZ
    // ========================================================================
    phaseState: { index: 0, score: 0, answered: false },

    startLevel3() {
        this.showScreen('level3Screen');
        this.phaseState.index = 0;
        this.phaseState.score = 0;
        this.showPhaseQuestion();
    },

    showPhaseQuestion() {
        const ps = this.phaseState;
        if (ps.index >= this.phaseScenarios.length) {
            this.finishLevel(2, Math.max(0, ps.score));
            return;
        }

        ps.answered = false;
        const scenario = this.phaseScenarios[ps.index];
        document.getElementById('phaseCounter').textContent = `Szenario ${ps.index + 1} / ${this.phaseScenarios.length}`;
        document.getElementById('phaseEmoji').textContent = scenario.emoji;
        document.getElementById('phaseScenario').textContent = scenario.text;

        // Reset buttons
        document.querySelectorAll('.phase-btn').forEach(btn => {
            btn.classList.remove('correct', 'wrong');
            btn.disabled = false;
        });
        document.querySelector('#level3Screen .btn-skip').disabled = false;
    },

    // Skip messages
    funnySkips: [
        'Strategischer R√ºckzug! Manchmal ist Weglaufen die beste Option. üèÉüí®',
        '√úbersprungen! Wie ein Meeting ohne Agenda ‚Äì man geht einfach weiter.',
        'Kein Kommentar? Verst√§ndlich, haben Sie einen sch√∂nen Tag! ‚òÄÔ∏è',
        'Skip! Das w√§re auch mein erster Instinkt gewesen. üòÖ',
        'Taktisches Ausweichman√∂ver! Sun Tzu w√§re stolz. ‚öîÔ∏è',
        'Lieber keine Antwort als eine falsche? Diplomatisch! üé©',
        '√úbersprungen wie ein Stein auf dem Wasser. Plop! üí¶',
        'Weiter! Daf√ºr hast du bestimmt beim n√§chsten eine Antwort. Oder? ü§û',
        'Schwamm dr√ºber! Das war eh eine Fangfrage. (War es nicht.) üßΩ',
        'Skip-Game strong! Leider gibt\'s daf√ºr keine Punkte. üìâ',
    ],

    getSkipMsg() {
        return this.funnySkips[Math.floor(Math.random() * this.funnySkips.length)];
    },

    skipPhase() {
        const ps = this.phaseState;
        if (ps.answered) return;
        ps.answered = true;

        // Disable all buttons
        document.querySelectorAll('.phase-btn').forEach(btn => btn.disabled = true);
        document.querySelector('#level3Screen .btn-skip').disabled = true;

        // Show correct answer
        const scenario = this.phaseScenarios[ps.index];
        const btnMap = { 'geplant': 0, 'umsetzung': 1, 'wiederkehrend': 2, 'abgeschlossen': 3 };
        document.querySelectorAll('.phase-btn')[btnMap[scenario.answer]].classList.add('correct');

        this._feedbackCallback = () => {
            ps.index++;
            this.showPhaseQuestion();
        };
        setTimeout(() => {
            this.showFeedback('üèÉ', this.getSkipMsg() + '<br><br><em style="color:var(--teal-light)">Richtig w√§re: <strong>' + document.querySelectorAll('.phase-btn')[btnMap[scenario.answer]].textContent + '</strong></em>', 0);
        }, 400);
    },

    checkPhase(answer) {
        const ps = this.phaseState;
        if (ps.answered) return;
        ps.answered = true;

        const scenario = this.phaseScenarios[ps.index];
        const isCorrect = answer === scenario.answer;

        // Disable skip button too
        document.querySelector('#level3Screen .btn-skip').disabled = true;

        // Highlight buttons
        const btnMap = { 'geplant': 0, 'umsetzung': 1, 'wiederkehrend': 2, 'abgeschlossen': 3 };
        const buttons = document.querySelectorAll('.phase-btn');
        buttons.forEach(btn => btn.disabled = true);

        if (isCorrect) {
            buttons[btnMap[answer]].classList.add('correct');
            ps.score += 25;
            this.score += 25;
        } else {
            buttons[btnMap[answer]].classList.add('wrong');
            buttons[btnMap[scenario.answer]].classList.add('correct');
            ps.score -= 5;
        }
        this.updateHud();

        // Show joke
        this._feedbackCallback = () => {
            ps.index++;
            this.showPhaseQuestion();
        };
        setTimeout(() => {
            this.showFeedback(
                isCorrect ? 'üéâ' : 'üòÖ',
                scenario.joke,
                isCorrect ? 25 : -5
            );
        }, 800);
    },

    // ========================================================================
    //  LEVEL 4: FORTSCHRITT VS REIFEGRAD
    // ========================================================================
    fvrState: { index: 0, score: 0, answered: false },

    startLevel4() {
        this.showScreen('level4Screen');
        this.fvrState.index = 0;
        this.fvrState.score = 0;
        this.showFvrQuestion();
    },

    showFvrQuestion() {
        const fs = this.fvrState;
        if (fs.index >= this.fvrScenarios.length) {
            this.finishLevel(3, Math.max(0, fs.score));
            return;
        }

        fs.answered = false;
        const scenario = this.fvrScenarios[fs.index];
        document.getElementById('fvrCounter').textContent = `${fs.index + 1} / ${this.fvrScenarios.length}`;
        document.getElementById('fvrEmoji').textContent = scenario.emoji;
        document.getElementById('fvrText').textContent = scenario.text;

        // Reset buttons
        document.querySelectorAll('.fvr-btn').forEach(btn => {
            btn.classList.remove('correct', 'wrong');
            btn.style.borderColor = '';
            btn.style.background = '';
        });
        document.querySelector('#level4Screen .btn-skip').disabled = false;
    },

    skipFvr() {
        const fs = this.fvrState;
        if (fs.answered) return;
        fs.answered = true;

        // Show correct answer
        const scenario = this.fvrScenarios[fs.index];
        const btnF = document.querySelector('.fvr-btn-fortschritt');
        const btnR = document.querySelector('.fvr-btn-reifegrad');
        (scenario.answer === 'fortschritt' ? btnF : btnR).style.borderColor = 'var(--green)';
        (scenario.answer === 'fortschritt' ? btnF : btnR).style.background = 'rgba(67,160,71,0.2)';
        document.querySelector('#level4Screen .btn-skip').disabled = true;

        this._feedbackCallback = () => {
            fs.index++;
            this.showFvrQuestion();
        };
        setTimeout(() => {
            this.showFeedback('üèÉ', this.getSkipMsg() + '<br><br><em style="color:var(--teal-light)">Richtig w√§re: <strong>' + (scenario.answer === 'fortschritt' ? 'üìä Fortschritt' : 'üèóÔ∏è Reifegrad') + '</strong></em>', 0);
        }, 400);
    },

    checkFvr(answer) {
        const fs = this.fvrState;
        if (fs.answered) return;
        fs.answered = true;

        const scenario = this.fvrScenarios[fs.index];
        const isCorrect = answer === scenario.answer;

        const btnF = document.querySelector('.fvr-btn-fortschritt');
        const btnR = document.querySelector('.fvr-btn-reifegrad');

        if (isCorrect) {
            fs.score += 30;
            this.score += 30;
            (answer === 'fortschritt' ? btnF : btnR).style.borderColor = 'var(--green)';
            (answer === 'fortschritt' ? btnF : btnR).style.background = 'rgba(67,160,71,0.2)';
        } else {
            (answer === 'fortschritt' ? btnF : btnR).style.borderColor = 'var(--red)';
            (answer === 'fortschritt' ? btnF : btnR).style.background = 'rgba(229,57,53,0.2)';
            (scenario.answer === 'fortschritt' ? btnF : btnR).style.borderColor = 'var(--green)';
            (scenario.answer === 'fortschritt' ? btnF : btnR).style.background = 'rgba(67,160,71,0.2)';
            fs.score -= 5;
        }
        this.updateHud();

        this._feedbackCallback = () => {
            fs.index++;
            this.showFvrQuestion();
        };
        setTimeout(() => {
            this.showFeedback(
                isCorrect ? 'üß†' : 'ü§î',
                `${scenario.explain}<br><br><em style="color:var(--orange)">${scenario.joke}</em>`,
                isCorrect ? 30 : -5
            );
        }, 600);
    },

    // ========================================================================
    //  LEVEL 5: BOSS BATTLE QUIZ
    // ========================================================================
    bossState: { index: 0, score: 0, answered: false },

    startLevel5() {
        this.showScreen('level5Screen');
        this.bossState.index = 0;
        this.bossState.score = 0;
        this.showBossQuestion();
    },

    showBossQuestion() {
        const bs = this.bossState;
        if (bs.index >= this.bossQuestions.length) {
            this.finishLevel(4, Math.max(0, bs.score));
            return;
        }

        bs.answered = false;
        const q = this.bossQuestions[bs.index];
        document.getElementById('bossCounter').textContent = `Frage ${bs.index + 1} / ${this.bossQuestions.length}`;
        document.getElementById('bossProgress').style.width = (bs.index / this.bossQuestions.length * 100) + '%';
        document.getElementById('bossQuestion').textContent = q.q;

        const container = document.getElementById('bossAnswers');
        container.innerHTML = '';
        q.answers.forEach((a, idx) => {
            const btn = document.createElement('button');
            btn.className = 'boss-answer';
            btn.textContent = `${['A', 'B', 'C', 'D'][idx]}) ${a}`;
            btn.onclick = () => this.checkBoss(idx);
            container.appendChild(btn);
        });
        document.querySelector('#level5Screen .btn-skip').disabled = false;
    },

    skipBoss() {
        const bs = this.bossState;
        if (bs.answered) return;
        bs.answered = true;

        const q = this.bossQuestions[bs.index];
        const buttons = document.querySelectorAll('.boss-answer');
        buttons.forEach(b => b.style.pointerEvents = 'none');
        buttons[q.correct].style.borderColor = 'var(--green)';
        buttons[q.correct].style.background = 'rgba(67,160,71,0.2)';
        document.querySelector('#level5Screen .btn-skip').disabled = true;

        this._feedbackCallback = () => {
            bs.index++;
            this.showBossQuestion();
        };
        setTimeout(() => {
            this.showFeedback('üèÉ', this.getSkipMsg() + '<br><br><em style="color:var(--teal-light)">Richtig w√§re: <strong>' + q.answers[q.correct] + '</strong></em>', 0);
        }, 400);
    },

    checkBoss(idx) {
        const bs = this.bossState;
        if (bs.answered) return;
        bs.answered = true;

        const q = this.bossQuestions[bs.index];
        const isCorrect = idx === q.correct;

        const buttons = document.querySelectorAll('.boss-answer');
        buttons.forEach(b => b.style.pointerEvents = 'none');
        document.querySelector('#level5Screen .btn-skip').disabled = true;

        if (isCorrect) {
            buttons[idx].style.borderColor = 'var(--green)';
            buttons[idx].style.background = 'rgba(67,160,71,0.2)';
            bs.score += 20;
            this.score += 20;
        } else {
            buttons[idx].style.borderColor = 'var(--red)';
            buttons[idx].style.background = 'rgba(229,57,53,0.2)';
            buttons[q.correct].style.borderColor = 'var(--green)';
            buttons[q.correct].style.background = 'rgba(67,160,71,0.2)';

            this.lives--;
            this.updateHud();
        }
        this.updateHud();

        this._feedbackCallback = () => {
            bs.index++;
            this.showBossQuestion();
        };
        setTimeout(() => {
            this.showFeedback(
                isCorrect ? 'üí™' : 'üò¨',
                q.joke,
                isCorrect ? 20 : 0
            );
        }, 600);
    },

    // ========================================================================
    //  RESULTS
    // ========================================================================
    showResults() {
        document.getElementById('hud').style.display = 'none';
        this.showScreen('resultsScreen');

        const maxScore = 25 * 12 + 30 * 9 + 25 * 8 + 30 * 8 + 20 * 10; // ~810 theoretical max
        const pct = Math.min(100, Math.round(this.score / maxScore * 100));

        document.getElementById('resultsScore').textContent = this.score;

        let rank, comment, trophy;
        if (pct >= 90) {
            rank = 'üèÜ Strategie-Guru der PHZH';
            comment = 'Unglaublich! Du beherrschst den Kompass wie kein*e Zweite*r! Die Hochschulleitung will dich im Team. Sofort.';
            trophy = 'üèÜ';
        } else if (pct >= 75) {
            rank = 'üåü Kompass-Kenner*in';
            comment = 'Sehr stark! Du navigierst sicher durch die Strategie-Welt. Dein Owner/Manager-Skills sind beeindruckend!';
            trophy = 'üåü';
        } else if (pct >= 55) {
            rank = 'üìã Initiativen-Insider*in';
            comment = 'Gut gemacht! Die Grundlagen sitzen. Mit etwas √úbung wirst du zum Kompass-Profi! Noch eine Runde?';
            trophy = 'üìã';
        } else if (pct >= 35) {
            rank = 'üîß Aktivit√§ten-Anf√§nger*in';
            comment = 'Ein solider Start! Rom wurde auch nicht an einem Meeting gebaut. Versuch\'s nochmal ‚Äì du wirst besser!';
            trophy = 'üîß';
        } else if (pct >= 15) {
            rank = 'üìù Massnahmen-Muffel';
            comment = 'Na ja... Immerhin warst du dabei! Das ist mehr als manche schaffen. Ab zur Nachhilfe und nochmal!';
            trophy = 'üìù';
        } else {
            rank = 'üòÖ Praktikant*in der Strategie';
            comment = '√Ñhm... Hast du die Intro-Geschichte durchgelesen? üòÑ Keine Sorge, √úbung macht den Kompass-Meister! Nochmal!';
            trophy = 'üòÖ';
        }

        document.getElementById('resultsRank').textContent = rank;
        document.getElementById('resultsComment').textContent = comment;
        document.getElementById('resultsTrophy').textContent = trophy;

        const statsDiv = document.getElementById('resultsStats');
        statsDiv.innerHTML = '';
        const levelNames = ['Sprint', 'Sortieren', 'Phasen', 'F vs. R', 'Boss'];
        this.levelScores.forEach((s, i) => {
            const box = document.createElement('div');
            box.className = 'stat-box';
            box.innerHTML = `<div class="stat-value">${s}</div><div class="stat-label">${levelNames[i]}</div>`;
            statsDiv.appendChild(box);
        });

        // Confetti effect for high scores
        if (pct >= 55) this.launchConfetti();
    },

    launchConfetti() {
        for (let i = 0; i < 50; i++) {
            setTimeout(() => {
                const confetti = document.createElement('div');
                confetti.style.cssText = `
                    position: fixed;
                    top: -10px;
                    left: ${Math.random() * 100}%;
                    width: ${Math.random() * 10 + 5}px;
                    height: ${Math.random() * 10 + 5}px;
                    background: ${['#FFD600', '#FF9800', '#E53935', '#43A047', '#1E88E5', '#8E24AA', '#00897B'][Math.floor(Math.random() * 7)]};
                    border-radius: ${Math.random() > 0.5 ? '50%' : '0'};
                    z-index: 500;
                    pointer-events: none;
                    animation: confettiFall ${2 + Math.random() * 3}s linear forwards;
                `;
                document.body.appendChild(confetti);
                setTimeout(() => confetti.remove(), 5000);
            }, i * 80);
        }

        // Add confetti animation
        if (!document.getElementById('confettiStyle')) {
            const style = document.createElement('style');
            style.id = 'confettiStyle';
            style.textContent = `
                @keyframes confettiFall {
                    0% { transform: translateY(-10px) rotate(0deg); opacity: 1; }
                    100% { transform: translateY(110vh) rotate(${360 + Math.random() * 360}deg); opacity: 0; }
                }
            `;
            document.head.appendChild(style);
        }
    },

    restart() {
        this.score = 0;
        this.lives = 3;
        this.currentLevel = 0;
        this.levelScores = [0, 0, 0, 0, 0];
        this.role = null;
        document.querySelectorAll('.role-card').forEach(c => c.classList.remove('selected'));
        document.getElementById('roleConfirmBtn').style.display = 'none';
        document.getElementById('hud').style.display = 'none';
        this.showScreen('titleScreen');
    },

    // ========================================================================
    //  INPUT HANDLING
    // ========================================================================
    setupKeyboard() {
        document.addEventListener('keydown', (e) => {
            if (this.currentLevel === 0 && document.getElementById('level1Screen').classList.contains('active')) {
                const cs = this.catchState;
                if (e.key === 'ArrowLeft') {
                    this.moveBucket(-1);
                } else if (e.key === 'ArrowRight') {
                    this.moveBucket(1);
                } else if (e.key === '1') {
                    cs.activeBucket = 0;
                    this.updateBucketHighlight();
                } else if (e.key === '2') {
                    cs.activeBucket = 1;
                    this.updateBucketHighlight();
                } else if (e.key === '3') {
                    cs.activeBucket = 2;
                    this.updateBucketHighlight();
                }
            }
        });
    },

    setupTouch() {
        const area = document.getElementById('catchArea');
        if (!area) return;

        area.addEventListener('touchstart', (e) => {
            if (!document.getElementById('level1Screen').classList.contains('active')) return;
            e.preventDefault();
            const touch = e.touches[0];
            const rect = area.getBoundingClientRect();
            const x = touch.clientX - rect.left;

            // Check if tapped on a bucket
            for (let i = 0; i < 3; i++) {
                const bucket = document.getElementById(`bucket${i}`);
                const bRect = bucket.getBoundingClientRect();
                const bx = bRect.left - rect.left;
                if (x >= bx && x <= bx + bRect.width) {
                    this.catchState.activeBucket = i;
                    this.updateBucketHighlight();
                    return;
                }
            }

            // Otherwise move active bucket toward tap
            if (x < rect.width / 2) {
                this.moveBucket(-2);
            } else {
                this.moveBucket(2);
            }
        }, { passive: false });

        area.addEventListener('touchmove', (e) => {
            if (!document.getElementById('level1Screen').classList.contains('active')) return;
            e.preventDefault();
            const touch = e.touches[0];
            const rect = area.getBoundingClientRect();
            const x = touch.clientX - rect.left;

            const bucket = document.getElementById(`bucket${this.catchState.activeBucket}`);
            bucket.style.left = Math.max(0, Math.min(rect.width - 120, x - 60)) + 'px';
        }, { passive: false });
    }
};

// ========================================================================
//  BOOT
// ========================================================================
document.addEventListener('DOMContentLoaded', () => Game.init());
</script>
</body>
</html>
